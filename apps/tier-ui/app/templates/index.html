{% extends "layout.html" %}
{% block content %}
<header class="header">
  <div>
    <h1>M7 Hero Tier List</h1>
    <p>SSR UI from scraper endpoint: <code>{{ scraper_base_url }}/api/tier-list/m7</code></p>
  </div>
  <div class="meta">
    <span>Generated: {{ generated_at if generated_at else '-' }}</span>
    <a class="btn" href="/?role={{ selected_role }}&refresh=true">Refresh Data</a>
  </div>
</header>

{% if error %}
<section class="error">Failed loading data: {{ error }}</section>
{% else %}
<nav class="roles">
  {% for role in role_order %}
  <a href="/?role={{ role }}" class="role-tab {% if role == selected_role %}active{% endif %}">
    {{ role_labels.get(role, role) }}
  </a>
  {% endfor %}
</nav>

<section class="legend">
  {% for tier, rule in tier_rules.items() %}
  <div><strong>{{ tier }}</strong>: {{ rule }}</div>
  {% endfor %}
</section>

{% set hero_details = role_data.get('heroDetails', []) %}
{% if not hero_details %}
<section class="error">No hero details available for this role.</section>
{% else %}
{% for tier in ['SS', 'S', 'A', 'B', 'C', 'D'] %}
  {% set heroes = hero_details | selectattr('tier', 'equalto', tier) | list %}
  <section class="tier-block">
    <div class="tier-title tier-{{ tier|lower }}">{{ tier }}</div>
    <div class="hero-grid">
      {% for hero in heroes %}
      <article class="hero-card">
        <h3>{{ hero.hero }}</h3>
        <p class="score">Score: {{ "%.3f"|format(hero.score) }}</p>
        <p class="stats">
          PickWin: {{ hero.stats.pickWinCount }} | Pick: {{ hero.stats.pickCount }} | Ban: {{ hero.stats.banCount }} | WR: {{ "%.1f"|format(hero.stats.winRate * 100) }}%
        </p>
        <p class="small"><strong>Countered By:</strong>
          {% if hero.counters.counteredBy %}
            {{ hero.counters.counteredBy | map(attribute='hero') | list | join(', ') }}
          {% else %}
            -
          {% endif %}
        </p>
        <p class="small"><strong>Strong Against:</strong>
          {% if hero.counters.strongAgainst %}
            {{ hero.counters.strongAgainst | map(attribute='hero') | list | join(', ') }}
          {% else %}
            -
          {% endif %}
        </p>
      </article>
      {% endfor %}
    </div>
  </section>
{% endfor %}
{% endif %}
{% endif %}
{% endblock %}
